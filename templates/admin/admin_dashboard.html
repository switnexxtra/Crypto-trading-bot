{% extends "base.html" %}

{% block content %}
    
    
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />

    <!-- <link rel="stylesheet" href="../css/users_dashboard.css">
    <link rel="stylesheet" href="../css/admin_dashboard.css"> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/users_dashboard.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">


    <div class="wrapper d-flex align-items-stretch">
        
        <nav id="sidebar" class="active">
            <h1><a href="{{url_for('main.home')}}" class="logo">M.</a></h1>
            <ul class="list-unstyled components mb-5 mt-5">
                <li class="active">
                    <a href="{{url_for('admin.dashboard')}}" class="text-success text-decoration-none" style="background-color: #FFFFFF; opacity: .7; border-radius:3px;"><span class="fa fa-home"></span> Home</a>
                </li>
                <li>
                    <a href="{{url_for('admin.investment')}}" class="text-decoration-none"><span class="fa fa-handshake"></span> Investment</a>
                </li>
                <li>
                    <a href="{{url_for('admin.loan')}}" class="text-decoration-none"><span class="fa fa-money"></span> Loan</a>
                </li>
                <li>
                    <a href="{{url_for('admin.transactions')}}" class="text-decoration-none"><span class="fa fa-book"></span> Transaction history</a>
                </li>
                <li>
                    <a href="{{url_for('admin.users')}}" class="text-decoration-none"><span class="fa fa-user-md"></span> Users</a>
                </li>
                <li>
                    <a href="{{url_for('admin.kyc')}}" class="text-decoration-none"><span class="fa fa-users"></span> Kyc</a>
                </li>

                <li>
                    <a href="{{url_for('admin.support')}}" class="text-decoration-none"><span class="fa fa-support"></span> Support</a>
                </li>
                <li>
                    <a href="{{url_for('auth.logout')}}" class="text-decoration-none"><span class="fa fa-sign-out"></span> Logout</a>
                </li>
            </ul>

        </nav>

        

        <!-- Page Content  -->
        <div id="content" class="p-4 p-md-5">

            <div class="profile-container d-flex justify-content-between align-items-center">
                <div class="text-center">
                    <p class="pt-2 user-name">Hello, <span> {{ user.username }} </span></p>
                </div>
            
                <div class="d-flex align-items-center ms-auto">
                    <i class="fa fa-bell fa-lg mx-2"></i>
                    <i class="fa fa-envelope fa-lg mx-2"></i>
                    <i class="fa fa-cog fa-lg mx-2"></i>
                    {% if user.gender == 'male' %}
                    <img src="{{ url_for('static', filename='img/male1.png') }}" class="rounded-circle l-bg-cherry" width="40" height="40"
                        alt="Profile">
                    {% elif user.gender == 'female' %}
                    <img src="{{ url_for('static', filename='img/female.png') }}" class="rounded-circle l-bg-pink" width="40" height="40"
                        alt="Profile">
                    {% else %}
                    <img src="{{ url_for('static', filename='img/gender.png') }}" class="rounded-circle l-bg-orange" width="40" height="40"
                        alt="Profile">
                    {% endif %}
                </div>
            </div>


            <!-- Nav Content  -->
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container-fluid">

                    <button type="button" id="sidebarCollapse" class="btn toggle-btn">
                        <i class="fa fa-bars"></i>
                        <span class="sr-only">Toggle Menu</span>
                    </button>

                    <div class="align-items-center text-center justify-content-center">
                        <p class="pt-2 pr-3 balance">Balance: <span>$20k </span></p>
                    </div>
                </div>
            </nav>


            <!-- Balance cards  -->
            

            <!-- Plan Cards and others -->
            <div class="container">
                <div class="plans_and_others_container">
                    <div class="row mt-3 mb-3">
                        <div class="col-md-3 mb-2 ">
                            <div class="admin_balance_cards small-card p-4 d-flex l-bg-blue">
                                <p class="plan_card_icons"><i class="fa fa-money l-bg-pink p-2"></i></p>
                                <div class="plan_texts">
                                    <p class="card_subheader">Total Invests</p>
                                    <h4 class="card_header">$42,000</h4>
                                        
                                </div>

                            </div>
                        </div>

                        <div class="col-md-3 mb-2 ">
                            <div class="admin_balance_cards small-card p-4 d-flex l-bg-pink">
                                <p class="plan_card_icons"><i class="fa fa-spinner l-bg-blue p-2"></i></p>
                                <div class="plan_texts">
                                    <p class="card_subheader">Total pending invest</p>
                                    <h4 class="card_header">$12,000</h4>
                        
                                </div>
                        
                            </div>
                        </div>

                        <div class="col-md-3 mb-2 ">
                            <div class="admin_balance_cards small-card p-4 d-flex l-bg-green">
                                <p class="plan_card_icons"><i class="fa fa-cubes l-bg-pink p-2"></i></p>
                                <div class="plan_texts">
                                    <p class="card_subheader">Total Intrest Amount</p>
                                    <h4 class="card_header">$6,000</h4>
                        
                                </div>
                        
                            </div>
                        </div>

                        <div class="col-md-3 mb-2 ">
                            <div class="admin_balance_cards small-card p-4 d-flex l-bg-orange">
                                <p class="plan_card_icons"><i class="fa fa-users l-bg-purple p-2"></i></p>
                                <div class="plan_texts">
                                    <p class="card_subheader">Total Users</p>
                                    <h4 class="card_header">100</h4>
                        
                                </div>
                        
                            </div>
                        </div>



                        <div class="col-md-3 mb-2 ">
                            <div class="admin_balance_cards small-card p-4 d-flex l-bg-purple">
                                <p class="plan_card_icons"><i class="fa fa-users l-bg-green p-2"></i></p>
                                <div class="plan_texts">
                                    <p class="card_subheader">Total Active Users</p>
                                    <h4 class="card_header">38</h4>
                        
                                </div>
                        
                            </div>
                        </div>
                        
                        <div class="col-md-3 mb-2 ">
                            <div class="admin_balance_cards small-card p-4 d-flex l-bg-teal">
                                <p class="plan_card_icons"><i class="fa fa-users l-bg-blue p-2"></i></p>
                                <div class="plan_texts">
                                    <p class="card_subheader">Total Deactived Users</p>
                                    <h4 class="card_header">12</h4>
                        
                                </div>
                        
                            </div>
                        </div>
                        
                        <div class="col-md-3 mb-2 ">
                            <div class="admin_balance_cards small-card p-4 d-flex l-bg-yellow">
                                <p class="plan_card_icons"><i class="fa fa-coins l-bg-pink p-2"></i></p>
                                <div class="plan_texts">
                                    <p class="card_subheader">Total Withdrawal</p>
                                    <h4 class="card_header">$6,000</h4>
                        
                                </div>
                        
                            </div>
                        </div>
                        
                        <div class="col-md-3 mb-2 ">
                            <div class="admin_balance_cards w-10 small-card p-4 d-flex l-bg-cherry">
                                <p class="plan_card_icons"><i class="fa fa-spinner l-bg-green p-2"></i></p>
                                <div class="plan_texts">
                                    <p class="card_subheader">Total Pending Withdraw</p>
                                    <h4 class="card_header">100</h4>
                        
                                </div>
                        
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>


            <!-- Payment section -->
            <div class="container refferal_container">
            
                <div class="container d-flex text-center align-center justify-content-center">
                    <div>
                        <h5 class="all_refferals pt-5 text-center mt-3">
                            All Payment Methods
                        </h5>
                    </div>

                    <div>
                        <button class="btn mt-5" style="border: none;" data-bs-toggle="modal" data-bs-target="#addPaymentModal"><i style="border-radius: 6px; margin-top: 3px;" class="fa fa-plus l-bg-pink p-2"></i></button>
                    </div>
                    

                    <!-- Payment Modal -->
                    <div class="modal fade" id="addPaymentModal" tabindex="-1" aria-labelledby="addPaymentModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="addPaymentModalLabel">Add Payment Method</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form action="{{ url_for('admin.add_payment_method') }}" method="Post" enctype="multipart/form-data" id="paymentForm">
                                        <div class="mb-3">
                                            <label for="payment-method">Select Payment Method:</label>
                                            <select id="payment-method" name="method" class="form-control" onchange="togglePaymentFields()">
                                                <option value="">-- Select --</option>
                                                <option value="paypal">PayPal Transfer</option>
                                                <option value="google_pay">Google Pay</option>
                                                <option value="bitcoin">Bitcoin</option>
                                                <option value="western_union">Western Union</option>
                                                <option value="transfer_wise">Transfer Wise</option>
                                                <option value="bank_transfer">Bank Transfer</option>
                                                <option value="skrill">Skrill Transfer</option>
                                                <option value="payoneer">Payoneer</option>
                                            </select>
                                        </div>
                    
                                        <!-- General Fields -->
                                        <div id="general-fields" class="mb-3">
                                            <label for="details">Payment Details:</label>
                                            <input type="text" class="form-control" id="details" name="details">
                                        </div>
                    
                                        <!-- Bank Fields -->
                                        <div id="bank-fields" class="mb-3 d-none">
                                            <label for="bank-name">Bank Name:</label>
                                            <input type="text" class="form-control" id="bank-name" name="bank_name">
                                            <label for="account-number" class="mt-2">Account Number:</label>
                                            <input type="text" class="form-control" id="account-number" name="account_number">
                                            <label for="account-name" class="mt-2">Account Name:</label>
                                            <input type="text" class="form-control" id="account-name" name="account_name">
                                        </div>
                    
                                        <!-- Crypto Fields -->
                                        <div id="crypto-fields" class="mb-3 d-none">
                                            <label for="wallet-address">Wallet Address:</label>
                                            <input type="text" class="form-control" id="wallet-address" name="wallet_address">
                                            <label for="memo" class="mt-2">Memo:</label>
                                            <input type="text" class="form-control" id="memo" name="memo">
                                            <label for="network-address" class="mt-2">Network Address:</label>
                                            <input type="text" class="form-control" id="network-address" name="network_address">
                                        </div>
                    
                                        <!-- QR Code Upload for Bitcoin -->
                                        <div id="qr-code-field" class="mb-3 d-none">
                                            <label for="qr-code">Upload QR Code:</label>
                                            <input type="file" class="form-control" id="qr-code" name="qr_code">
                                        </div>
                    
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                            <button type="submit" class="btn btn-primary">Save Payment Method</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
                
            
            
                <div class="container py-3">
                    <div class="row">
                        <div class="col-lg-12 mx-auto bg-white rounded shadow p-3">
            
                            <!-- Table with fixed header and scrolling body -->
                            <div class="table-responsive">
                                <table class="table table-striped table-hover table-fixed">
                                    <thead class="thead primary-bg-color">
                                        <tr class="primary-bg-color">
                                            <th scope="col">#</th>
                                            <th>Method Type</th>
                                            <th>Details</th>
                                            <th>Account Number</th>
                                            <th>Bank Name</th>
                                            <th>Account Name</th>
                                            <th>Wallet Address</th>
                                            <th>Memo</th>
                                            <th>Network Address</th>
                                            <th scope="col">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                        {% for payment_method in payment_methods %}
                                            <tr>
                                                <!-- <th scope="row">1</th> -->
                                                <th scope="row">{{ loop.index }}</th>
                                                <td>{{ payment_method.method }}</td>
                                                <td>{{ payment_method.details }}</td>
                                                <td>{{ payment_method.account_number or 'N/A' }}</td>
                                                <td>{{ payment_method.bank_name or 'N/A' }}</td>
                                                <td>{{ payment_method.account_name or 'N/A' }}</td>
                                                <td>{{ payment_method.wallet_address[:8] or 'N/A' }}...</td>
                                                <td>{{ payment_method.memo[:8] or 'N/A' }}...</td>
                                                <td>{{ payment_method.network_address or 'N/A' }}</td>
                                                <td>
                                                    <div class="flex d-flex">
                                                        <button class="btn" onclick='openEditModal({
                                                            "id": "{{ payment_method.id }}",
                                                            "method": "{{ payment_method.method }}",
                                                            "details": "{{ payment_method.details }}",
                                                            "account_number": "{{ payment_method.account_number }}",
                                                            "bank_name": "{{ payment_method.bank_name }}",
                                                            "account_name": "{{ payment_method.account_name }}",
                                                            "wallet_address": "{{ payment_method.wallet_address }}",
                                                            "memo": "{{ payment_method.memo }}",
                                                            "network_address": "{{ payment_method.network_address }}",
                                                            "image_url": "{{ url_for('static', filename='uploads/' + payment_method.image_url) if payment_method.image_url else '' }}"
                                                        })'><i class="fa fa-pencil l-bg-blue p-2"></i></button>
                                                        <!-- <button class="btn"><i class="fa fa-trash l-bg-red p-2"></i></button> -->
                                                        <form action="{{ url_for('admin.delete_payment_method', id=payment_method.id) }}" method="POST"
                                                            onsubmit="return confirm('Are you sure you want to delete this payment method?');">
                                                            <button type="submit" class="btn"><i class="fa fa-trash l-bg-red p-2"></i></button>
                                                        </form>

                                                        <!-- <button class="btn"><i class="fa fa-check l-bg-green p-2"></i></button> -->
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            <!-- End -->
            
                            <!-- Edit Payment Modal -->
                            <div class="modal fade" id="editPaymentModal" tabindex="-1" aria-labelledby="editPaymentModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">Edit Payment Method</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <form action="{{ url_for('admin.edit_payment_method') }}" method="POST" enctype="multipart/form-data">
                                                <input type="hidden" id="edit-payment-id" name="payment_id">
                            
                                                <div class="mb-3">
                                                    <label for="edit-method">Payment Method:</label>
                                                    <select id="edit-method" class="form-control" name="method">
                                                        <option value="paypal">PayPal Transfer</option>
                                                        <option value="google_pay">Google Pay</option>
                                                        <option value="bitcoin">Bitcoin</option>
                                                        <option value="western_union">Western Union</option>
                                                    </select>
                                                </div>
                            
                                                <div class="mb-3">
                                                    <label for="edit-details">Payment Details:</label>
                                                    <input type="text" class="form-control" id="edit-details" name="details">
                                                </div>
                            
                                                <div class="mb-3">
                                                    <label for="edit-account-number">Account Number:</label>
                                                    <input type="text" class="form-control" id="edit-account-number" name="account_number">
                                                </div>
                            
                                                <div class="mb-3">
                                                    <label for="edit-bank-name">Bank Name:</label>
                                                    <input type="text" class="form-control" id="edit-bank-name" name="bank_name">
                                                </div>
                            
                                                <div class="mb-3">
                                                    <label for="edit-account-name">Account Name:</label>
                                                    <input type="text" class="form-control" id="edit-account-name" name="account_name">
                                                </div>
                            
                                                <div class="mb-3">
                                                    <label for="edit-wallet-address">Wallet Address:</label>
                                                    <input type="text" class="form-control" id="edit-wallet-address" name="wallet_address">
                                                </div>
                            
                                                <div class="mb-3">
                                                    <label for="edit-memo">Memo:</label>
                                                    <input type="text" class="form-control" id="edit-memo" name="memo">
                                                </div>
                            
                                                <div class="mb-3">
                                                    <label for="edit-network-address">Network Address:</label>
                                                    <input type="text" class="form-control" id="edit-network-address" name="network_address">
                                                </div>
                            
                                                <div class="mb-3">
                                                    <label for="edit-image-preview">Current Image:</label>
                                                    <br>
                                                    <img id="edit-image-preview" src="" alt="Payment Method Image" class="img-fluid mb-2"
                                                        style="max-height: 150px;">
                                                </div>
                            
                                                <div class="mb-3">
                                                    <label for="edit-image">Upload New Image:</label>
                                                    <input type="file" class="form-control" id="edit-image" name="image">
                                                </div>
                            
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                    <button type="submit" class="btn btn-primary">Update Payment Method</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>
            
                </div>
            </div>


            <!-- Toast Notification -->
            <div class="toast-container">
                <div id="copyToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive"
                    aria-atomic="true">
                    <div class="d-flex">
                        <div class="toast-body">
                            Copied to clipboard!
                        </div>
                        <button type="button" class="btn-close btn-light  m-auto text-light" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            </div>

            <!-- Transaction section -->
            <div class="container refferal_container">
            
                <h5 class="all_refferals pt-5 text-center mt-2">
                    All Transactions From Users
                </h5>
            
            
                <div class="container py-3">
                    <div class="row">
                        <div class="col-lg-12 mx-auto bg-white rounded shadow p-3">
                            <!-- Table with fixed header and scrolling body -->
                            <div class="table-responsive">
                                <table class="table table-striped table-hover table-fixed">
                                    <thead class="thead primary-bg-color">
                                        <tr class="primary-bg-color">
                                            <th scope="col">#</th>
                                            <th scope="col">transationID</th>
                                            <th scope="col">Date</th>
                                            <th scope="col">Username</th>
                                            <th scope="col">Type</th>
                                            <th scope="col">Details</th>
                                            <th scope="col">Amount</th>
                                            <th scope="col">Status</th>
                                            <th scope="col">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for transaction in transactions %}
                                        <tr>
                                            <th class="mt-3 pt-3" scope="row">{{ loop.index }}</th>
                                            <td class="mt-3 pt-3">{{ transaction.transaction_id }}</td>
                                            <td class="mt-3 pt-3">{{ transaction.created_at.strftime('%d-%m-%Y') }}</td>
                                            <td class="mt-3 pt-3">{{ transaction.user.username }}</td>
                                            <td class="mt-3 pt-3">{{ transaction.transaction_type }}</td>
                                            <td class="mt-3 pt-3">{{ transaction.transaction_detail }}</td>
                                            <td class="mt-3 pt-3">${{ transaction.amount }}</td>
                                            <td class="mt-3 pt-3">
                                                {% if transaction.status in ["Pending", "pending"] %}
                                                <p class="bg-warning text-dark p-2 d-inline">Pending</p>
                                                {% elif transaction.status in ["Completed", "completed"] %}
                                                <p class="bg-success text-white p-2 d-inline">Completed</p>
                                                {% elif transaction.status in ["Failed", "failed"] %}
                                                <p class="bg-danger text-white p-2 d-inline">Failed</p>
                                                {% else %}
                                                <p class="bg-secondary text-white p-2 d-inline">{{ transaction.status }}</p>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <!-- Buttons -->
                                                <div class="flex">
                                                    <button class="btn edit-btn" data-transaction-id="{{ transaction.id }}"><i
                                                            class="fa fa-pencil l-bg-blue p-2 mb-4 rounded-2"></i></button>
                                                    <button class="btn delete-btn" data-transaction-id="{{ transaction.id }}"><i
                                                            class="fa fa-trash l-bg-red p-2 mb-4 rounded-2"></i></button>
                                                    <button class="btn confirm-btn" data-transaction-id="{{ transaction.id }}"><i
                                                            class="fa fa-check l-bg-green p-2 mb-4 rounded-2"></i></button>
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            
                <!-- Modals - moved outside of the table -->
                <!-- Edit Modal -->
                <div class="modal fade" id="editTransactionModal" tabindex="-1" aria-labelledby="editTransactionModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editTransactionModalLabel">Edit Transaction Status</h5>
                                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="editTransactionForm">
                                    <input type="hidden" id="transactionId" name="transaction_id">
                                    <label for="status">Status:</label>
                                    <select id="status" class="form-control">
                                        <option value="pending">Pending</option>
                                        <option value="completed">Completed</option>
                                        <option value="failed">Failed</option>
                                    </select>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" id="saveChangesBtn">Save Changes</button>
                            </div>
                        </div>
                    </div>
                </div>
            
            </div>

        </div>

        
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    

    
    <!-- jQuery (for dynamic content) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Bootstrap JS (for modal) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='js/jquery.min.js') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='js/popper.js') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='js/bootstrap.min.js') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='js/index.js') }}">
{% endblock %}